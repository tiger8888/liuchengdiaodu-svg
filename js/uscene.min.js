var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},uscene=function(){function t(){this.defaultPath={ok:"M5,18l20.002,20.003l-5,5L0,23L5,18z M14.998,38.003L45,8l5,5L19.998,43.001L14.998,38.003z"},this.defaultJson={setting:{zoom:1,svgWidth:1e3,svgHeight:1e3,draggable:!0,editing:!0,multiLine:!1},object:{left:440,top:140,id:null,container:{type:"circle",fill:"#a7acb8","fill-opacity":null,stroke:null,"stroke-width":null,width:30,height:30},content:{type:"path",source:"ok",fill:"#fff","fill-opacity":null,scaleX:.3,scaleY:.3},title:{text:"节点名称",style:{fill:"#666","text-anchor":"middle",size:12}}},line:{array:null,sNode:"",eNode:"",id:"",type:"",arrow:!0,animation:!1,style:{stroke:"#999","stroke-width":1,"stroke-dasharray":null,fill:"none"},title:{text:"线条名称",style:{fill:"#999","text-anchor":"middle",size:12}}}},this.setting={zoom:1,svgWidth:"100%",svgHeight:"100%",draggable:!0,editing:!0,multiLine:!1}}return t.prototype.init=function(t){this.draw=SVG(t).size("100%","100%"),this.spof(),this.draw.origin=this,this.drawLine(),this.drawBrokenLine()},t.prototype.resize=function(t,e,n){2==arguments.length?n=this.setting.zoom:1==arguments.length?(n=t,t=this.setting.svgWidth,e=this.setting.svgHeight):0==arguments.length&&(n=this.setting.zoom,t=this.setting.svgWidth,e=this.setting.svgHeight),SVG.zoom=n,$(this.draw.node).css({transform:"scale("+n+","+n+")","-webkit-transform":"scale("+n+","+n+")","-ms-transform":"scale("+n+","+n+")","-moz-transform":"scale("+n+","+n+")"}),this.draw.size(t,e),"number"!=typeof t&&/%/.test(t)?$(this.draw.node).parent().css("width",$(this.draw.node).parent().parent().innerWidth()*n*parseInt(t)/100):$(this.draw.node).parent().css("width",t*n),"number"!=typeof e&&/%/.test(e)?$(this.draw.node).parent().css("height",$(this.draw.node).parent().parent().innerHeight()*n*parseInt(e)/100):$(this.draw.node).parent().css("height",e*n)},t.prototype.clean=function(){$(this.draw._defs.node).html("").siblings().remove()},t.prototype.creatMarker=function(t){return new marker(this,t).marker},t.prototype.creatNode=function(t){return new node(this,t)},t.prototype.creatLine=function(t){return new line(this,t)},t.prototype.creatBrokenLine=function(t){return new brokenLine(this,t)},t.prototype.spof=function(){var t=this;this.draw.spof(),SVG.on(window,"resize",function(){t.draw.spof()})},t.prototype.get=function(t){return SVG.get(t)},t.prototype.select=function(t){return SVG.select(t).members},t.prototype.resetting=function(t){var e=t;void 0!=e.draggable&&e.draggable!=this.setting.draggable&&$('g[id^="node"]').each(function(){this.instance.draggable(e.draggable)}),this.setting=$.extend(!0,{},this.setting,e),this.resize(this.setting.svgWidth,this.setting.svgHeight,this.setting.zoom)},t.prototype.drawLine=function(){var t,e,n,i,o=this;this.drawLine.init=function(t){t="undefined"==typeof t||t,o.resetting({draggable:!t}),t?($(document).off("mousedown","g[id^='node']",o.drawLine.drawLineStart),$(document).on("mousedown","g[id^='node']",o.drawLine.drawLineStart)):$(document).off("mousedown","g[id^='node']",o.drawLine.drawLineStart)},this.drawLine.drawLineStart=function(i){var r=this.instance.container.tbox();n=this.instance,e=$(o.draw.node).offset(),t=o.draw.polyline([[r.cx,r.cy],[r.cx,r.cy]]).attr(o.defaultJson.line.style),t.arrowMarker=o.draw.marker(10,10,function(t){t.polyline([[0,0],[0,10],[8,5]]).fill(o.defaultJson.line.style.stroke)}),t.marker("end",t.arrowMarker),t.style("pointer-events","none"),$(document).on("mousemove",o.drawLine.drawLineProcess),$(document).on("mouseup",o.drawLine.drawLineEnd),$(document).off("mousedown","g[id^='node']",o.drawLine.drawLineStart)},this.drawLine.drawLineProcess=function(n){t._array.value[1][0]=(n.clientX-e.left)*(1/o.setting.zoom),t._array.value[1][1]=(n.clientY-e.top)*(1/o.setting.zoom),t.plot(t._array.value)},this.drawLine.drawLineEnd=function(e){$(document).off("mousemove",o.drawLine.drawLineProcess),$(document).off("mouseup",o.drawLine.drawLineEnd);var r=$(e.target).closest("g[id^='node']");r[0]&&r[0].instance.id!=n.id&&(i=r[0].instance,o.drawLine.creatLine(n,i)),t.arrowMarker.remove(),t.remove(),$(document).on("mousedown","g[id^='node']",o.drawLine.drawLineStart)},this.drawLine.creatLine=function(t,e){var n=$.extend(!0,{},o.defaultJson.line);sNodeTbox=t.container.tbox(),eNodeTbox=e.container.tbox();var i=o.lineDistance(t.container.type,e.container.type,sNodeTbox,eNodeTbox),r=o.lineDistancePoint(i.sDistance,i.eDistance,sNodeTbox.cx,sNodeTbox.cy,eNodeTbox.cx,eNodeTbox.cy);n.sNode=t.id,n.eNode=e.id,n.type="straightLine",n.id="line_"+n.sNode+"_"+n.eNode;var a=$('polyline[id^="line_'+n.sNode+"_"+n.eNode+'"]').length;if(a){if(!o.setting.multiLine)return!1;n.id+="_"+a}n.array=r,o.creatLine(n)}},t.prototype.drawBrokenLine=function(){var t,e,n,i,o=this,r=[];this.drawBrokenLine.init=function(t){t="undefined"==typeof t||t,o.resetting({draggable:!t}),t?($(document).off("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart),$(document).on("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart)):$(document).off("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart)},this.drawBrokenLine.drawLineStart=function(i){$(document).off("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart);var a=this.instance.container.tbox();n=this.instance,e=$(o.draw.node).offset(),r=[[a.cx,a.cy],[a.cx,a.cy]],t=o.draw.polyline(r).attr(o.defaultJson.line.style),t.arrowMarker=o.draw.marker(10,10,function(t){t.polyline([[0,0],[0,10],[8,5]]).fill(o.defaultJson.line.style.stroke)}),t.marker("end",t.arrowMarker),$(document).on("mousemove",o.drawBrokenLine.drawLineProcess),$(document).on("mouseup",o.drawBrokenLine.drawLineEnd)},this.drawBrokenLine.drawLineProcess=function(n){var i=(n.clientX-e.left)*(1/o.setting.zoom),a=(n.clientY-e.top)*(1/o.setting.zoom);Math.abs(i-t._array.value[r.length-2][0])>Math.abs(a-t._array.value[r.length-2][1])?(t._array.value[r.length-1][0]=i,t._array.value[r.length-1][1]=t._array.value[r.length-2][1]):(t._array.value[r.length-1][0]=t._array.value[r.length-2][0],t._array.value[r.length-1][1]=a),t.plot(t._array.value)},this.drawBrokenLine.drawLineEnd=function(a){if(2==a.button)return $(document).off("mousemove",o.drawBrokenLine.drawLineProcess),$(document).off("mouseup",o.drawBrokenLine.drawLineEnd),t.arrowMarker.remove(),t.remove(),$(document).on("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart),!1;var s=$(a.target).closest("g[id^='node']");!s[0]||t._array.value[r.length-1][0]!=(a.clientX-e.left)*(1/o.setting.zoom)&&t._array.value[r.length-1][1]!=(a.clientY-e.top)*(1/o.setting.zoom)?r.splice(-1,0,[t._array.value[r.length-1][0],t._array.value[r.length-1][1]]):s[0]&&s[0].instance.id!=n.id?($(document).off("mousemove",o.drawBrokenLine.drawLineProcess),$(document).off("mouseup",o.drawBrokenLine.drawLineEnd),i=s[0].instance,o.drawBrokenLine.creatBrokenLine(n,i,r),t.arrowMarker.remove(),t.remove(),$(document).on("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart)):($(document).off("mousemove",o.drawBrokenLine.drawLineProcess),$(document).off("mouseup",o.drawBrokenLine.drawLineEnd),t.arrowMarker.remove(),t.remove(),$(document).on("mousedown","g[id^='node']",o.drawBrokenLine.drawLineStart))},this.drawBrokenLine.creatBrokenLine=function(t,e,n){var i=$.extend(!0,{},o.defaultJson.line);i.sNode=t.id,i.eNode=e.id,i.type="brokenLine",i.id="line_"+i.sNode+"_"+i.eNode;var r=$('polyline[id^="line_'+i.sNode+"_"+i.eNode+'"]').length;if(r){if(!o.setting.multiLine)return!1;i.id+="_"+r}i.array=n,o.creatBrokenLine(i);var a=t.container.tbox(),s=e.container.tbox(),c=SVG.get("line_"+t.id+"_"+e.id);c.lineChange(a.cx,a.cy,t.id),c.lineChange(s.cx,s.cy,e.id)}},t.prototype.getJson=function(){var t={setting:{},object:[],line:[]};return t.setting=this.setting,$('g[id^="node"]').each(function(){var e=this.instance,n=e.container.tbox(),i={left:n.x,top:n.y,id:e.id,container:{type:e.container.type,fill:e.container.attr("fill"),"fill-opacity":e.container.attr("fill-opacity"),stroke:e.container.attr("stroke"),"stroke-width":e.container.attr("stroke-width"),width:n.w,height:n.h},content:{type:e.content.type,source:e.content.attr("source"),fill:e.content.attr("fill"),"fill-opacity":e.content.attr("fill-opacity"),scaleX:new SVG.Matrix(e.content).extract().scaleX,scaleY:new SVG.Matrix(e.content).extract().scaleY},title:{text:e.title.text(),style:{fill:e.title.attr("fill"),"text-anchor":e.title.attr("text-anchor"),size:e.title.attr("size")}}};t.object.push(i)}),$('polyline[id^="line_node"]').each(function(){var e=this.instance,n={array:e._array.value,sNode:e.sNode,eNode:e.eNode,id:e.id,type:e.type,arrow:!0,animation:!1,style:{stroke:e.attr("stroke"),"stroke-width":e.attr("stroke-width"),"stroke-dasharray":e.attr("stroke-dasharray")},title:{text:e.title.text(),style:{fill:e.title.attr("fill"),"text-anchor":e.title.attr("text-anchor"),size:e.title.attr("size")}}};t.line.push(n)}),t},t.prototype.getSVG=function(){var t=$(this.draw.node).parent().html();return t},t.prototype.getImg=function(){var t=$(this.draw.node).parent().html(),e=new Image;e.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(t)));var n=document.createElement("canvas");n.width=$(this.draw.node).width()*this.setting.zoom,n.height=$(this.draw.node).height()*this.setting.zoom;var i=n.getContext("2d");i.drawImage(e,0,0);var o=n.toDataURL("image/png");return n.remove(),o},t.prototype.drawJson=function(t){var e=this;this.clean(),this.resetting(t.setting),t.line||(t.line=[]);for(var n=0;n<t.object.length;n++)!function(n){setTimeout(function(){e.creatNode(t.object[n])},1*n)}(n);setTimeout(function(){for(var n=0;n<t.line.length;n++)!function(n){setTimeout(function(){"straightLine"==t.line[n].type?e.creatLine(t.line[n]):e.creatBrokenLine(t.line[n])},1*n)}(n)},n)},t.prototype.randId=function(t){return t+parseInt(1e10*Math.random())},t.prototype.lineDistancePoint=function(t,e,n,i,o,r){var a,s,c,d;if(n==o)return a=n,s=o,r>i?(c=r-e,d=i+t):(c=r+e,d=i-t),[[a,d],[s,c]];var h=o==n?0:(r-i)/(o-n),l=Math.sqrt(1/(Math.pow(h,2)+1)),u=o>n?1:-1;return d=parseInt(i+u*h*l*t),a=parseInt(n+u*l*t),c=parseInt(r-u*h*l*e),s=parseInt(o-u*l*e),[[a,d],[s,c]]},t.prototype.linearrowheadPoint=function(t,e,n,i,o,r){var a,s,c,d,h,l,u=Math.sqrt(Math.pow(t,2)/(Math.pow(r,2)+1)),p=i>e?1:-1;return l=parseInt(o-p*r*u),h=parseInt(i-p*u),u/=Math.sqrt(3),a=h-r*u,c=l+u,s=h+r*u,d=l-u,{xa1:a,xa2:s,ya1:c,ya2:d}},t.prototype.rectcentertosidedistance=function(t,e,n){var i,o,r=Math.atan(t/e)/(Math.PI/180);return n<r?(i=n,o=e/2):n<90?(i=90-n,o=t/2):n<180-r?(i=n-90,o=t/2):n<180?(i=180-n,o=e/2):n<180+r?(i=n-180,o=e/2):n<270?(i=270-n,o=t/2):n<360-r?(i=n-270,o=t/2):(i=360-n,o=e/2),parseInt(o/Math.cos(i*(Math.PI/180)))},t.prototype.rectcentertosideangle=function(t,e,n,i){var o=n-t,r=i-e,a=0!=r?Math.atan(Math.abs(o/r))/(Math.PI/180):90;return 0==r&&o>0&&(a=270),0==o&&(a=r>0?0:180),o>0&&r>0?a=360-a:o<0&&r<0&&(a=180-a),a},t.prototype.lineDistance=function(t,e,n,i){var o,r;if("circle"==t)o=n.w/2;else{var a=this.rectcentertosideangle(i.cx,i.cy,n.cx,n.cy);o=this.rectcentertosidedistance(n.w,n.h,a)}if("circle"==e)r=i.w/2;else{var a=this.rectcentertosideangle(n.cx,n.cy,i.cx,i.cy);r=this.rectcentertosidedistance(i.w,i.h,a)}return{sDistance:o,eDistance:r}},t}(),node=function(){function t(t,e){return this.uscene=t,this.option=$.extend(!0,{},this.uscene.defaultJson.object,e),this.init(),this.group}return t.prototype.init=function(){this.id=this.option.id,this.creatContainer(),this.creatContent(),this.creatText(),this.creatgroup(),this.dragmove()},t.prototype.creatContainer=function(){"rect"==this.option.container.type?this.container=this.uscene.draw.rect(this.option.container.width,this.option.container.height):"circle"==this.option.container.type&&(this.container=this.uscene.draw.circle(this.option.container.width)),this.container.attr(this.option.container).attr({id:this.id+"_container"}).move(this.option.left,this.option.top),this.container.option=this.option.container},t.prototype.creatContent=function(){"path"==this.option.content.type&&(this.content=this.uscene.draw.path(this.uscene.defaultPath[this.option.content.source]?this.uscene.defaultPath[this.option.content.source]:this.option.content.source)),this.content.attr(this.option.content).attr({id:this.id+"_content"});var t=this.content.tbox(),e=this.container.tbox();this.content.move(e.cx-t.w/2,e.cy-t.h/2).scale(this.option.content.scaleX,this.option.content.scaleY),this.content.option=this.option.content},t.prototype.creatText=function(){this.title=this.uscene.draw.text(this.option.title.text).move(this.option.left+this.option.container.width/2,this.option.top+this.option.container.height+this.option.title.style.size/2+2),this.title.attr(this.option.title.style).font(this.option.title.style).attr({id:this.id+"_title"})},t.prototype.creatgroup=function(){this.group=this.uscene.draw.group(),this.group.add(this.container),this.group.add(this.content),this.group.add(this.title),this.group.draggable(this.uscene.setting.draggable),this.group.container=this.container,this.group.content=this.content,this.group.title=this.title,this.group.attr({id:this.id}),this.group.id=this.id,this.group.addSign=this.addSign,this.group.removeSign=this.removeSign,this.group.changeContainer=this.changeContainer,this.group.changeContent=this.changeContent,this.group.remove=this.remove},t.prototype.remove=function(){return $("polyline[id*='"+this.id+"']").each(function(){this.instance.remove()}),this.parent()&&this.parent().removeElement(this),this},t.prototype.changeContent=function(t){var e="Object"==typeof this.group?this.group:this,n=e.doc().origin;if(t=$.extend(!0,{},e.content.option,t),t.type="path")var i=n.draw.path(n.defaultPath[t.source]?n.defaultPath[t.source]:t.source);i.attr(t).attr({id:e.content.attr("id")}),i.option=t,e.content.replace(i),e.content=i;var o=this.container.bbox(),r=i.bbox();e.content.move(o.cx-r.w/2,o.cy-r.h/2).scale(t.scaleX,t.scaleY)},t.prototype.changeContainer=function(t){var e="Object"==typeof this.group?this.group:this,n=e.container.bbox(),i=e.doc().origin;t=$.extend(!0,{},e.container.option,t);var o;return"rect"==t.type?o=i.draw.rect(t.width,t.height):"circle"==t.type&&(o=i.draw.circle(t.width)),o.attr(t).attr({id:e.container.attr("id")}),o.option=t,e.container.replace(o),e.container=o,e.container.move(n.x,n.y),e},t.prototype.addSign=function(t){var e="Object"==typeof this.group?this.group:this,n=e.doc().origin,i=e.container.bbox();if(t.type="path")var o=n.draw.path(t.source);var r=o.tbox();return o.attr(t).move(i.cx-r.w/2+t.offsetX,i.cy-r.h/2+t.offsetY).scale(t.scaleX,t.scaleY),e.add(o),o},t.prototype.removeSign=function(t){var e="Object"==typeof this.group?this.group:this;if("undefined"==typeof t)for(var n=3;n<e.node.childNodes.length;n++)console.log(e.node.childNodes[n].instance),e.put(e.node.childNodes[n].instance),e.node.childNodes[n].instance.remove();else{var i=SVG.get(t);e.put(i),i.remove()}},t.prototype.dragmove=function(){var t=this;this.group.on("dragstart.group",function(){t.group.style("cursor","move");var e=t.group.attr("id");t.line=$("polyline[id*='"+e+"']"),t.group.on("dragmove.group",function(n){var i=t.group.container.tbox(),o=i.cx,r=i.cy;t.line.each(function(){this.instance.lineChange(o,r,e)})}),t.group.on("dragend.group",function(n){t.group.off("dragmove.group"),t.group.off("dragend.group"),t.group.style("cursor",null);var i=t.group.container.tbox(),o=i.cx,r=i.cy,a=$(t.uscene.draw.node).height(),s=$(t.uscene.draw.node).width();i.y2>a&&(t.uscene.resize(s,i.y2+50),t.uscene.setting.svgHeight=i.y2+50,t.uscene.setting.svgWidth=s),i.x2>s&&(t.uscene.resize(i.x2+50,a),t.uscene.setting.svgHeight=a,t.uscene.setting.svgWidth=i.x2+50),t.line.each(function(){this.instance.lineChange(o,r,e)})})})},t}(),marker=function(){function t(t,e){this.draw=t,this.option=e,this.init()}return t.prototype.init=function(){this.creatMarker()},t.prototype.creatMarker=function(){this.marker=this.draw.marker(10,10,function(t){t.polyline([[0,0],[0,10],[6,5],[0,0]]).fill("#f06").stroke({width:0})})},t}(),line=function(){function t(t,e){return this.uscene=t,this.sNode=e.sNode,this.eNode=e.eNode,this.option=e,this.init(),this.line}return t.prototype.init=function(){this.creatLine(),this.creatArrow(),this.creatText(),this.animation(this.option.animation)},t.prototype.creatArrow=function(){var t=this;this.arrowMarker=this.uscene.draw.marker(14,10,function(e){e.polyline([[0,0],[0,10],[8,5]]).fill(t.option.style.stroke)}),this.line.marker("end",this.arrowMarker)},t.prototype.creatArray=function(t,e){t=SVG.get(t),e=SVG.get(e),sNodeTbox=t.container.tbox(),eNodeTbox=e.container.tbox();var n=this.uscene.lineDistance(t.container.type,e.container.type,sNodeTbox,eNodeTbox),i=this.uscene.lineDistancePoint(n.sDistance,n.eDistance,sNodeTbox.cx,sNodeTbox.cy,eNodeTbox.cx,eNodeTbox.cy);return i},t.prototype.creatLine=function(){null==this.option.array&&(this.option.array=this.creatArray(this.sNode,this.eNode)),this.line=this.uscene.draw.polyline(this.option.array).attr(this.option.style),this.line.id=this.option.id?this.option.id:"line_"+this.sNode+"_"+this.eNode,this.line.type=this.option.type,this.line.attr({id:this.line.id,fill:"none"}),this.line.lineChange=this.lineChange,this.line.sNode=this.sNode,this.line.eNode=this.eNode,this.line.animation=this.animation,this.line.uscene=this.uscene,this.line.remove=this.remove,this.line.option=this.option},t.prototype.remove=function(){return SVG.get(this.id+"_title").remove(),this.parent()&&this.parent().removeElement(this),this},t.prototype.animation=function(t){t="undefined"==typeof t||t;var e=this.line?this.line:this;t?(void 0!=e.attr("stroke-dasharray")&&null!=e.attr("stroke-dasharray")&&"1"!=e.attr("stroke-dasharray")||e.attr("stroke-dasharray","5,5"),e.addClass("line_animation")):(void 0==e.option["stroke-dasharray"]?e.attr("stroke-dasharray",null):e.attr("stroke-dasharray",e.option["stroke-dasharray"]),e.removeClass("line_animation"))},t.prototype.creatText=function(){var t=this.line.bbox();this.title=this.uscene.draw.text(this.option.title.text).move(t.cx,t.cy),this.title.attr(this.option.title.style).font(this.option.title.style).attr({id:this.line.id+"_title"}),this.line.title=this.title},t.prototype.lineChange=function(t,e,n){var i=SVG.get(this.sNode).container,o=SVG.get(this.eNode).container,r=i.tbox(),a=o.tbox(),s=this.uscene.lineDistance(i.type,o.type,r,a),c=s.sDistance,d=s.eDistance;if(n==this.sNode){var h=this.uscene.lineDistancePoint(c,d,t,e,a.cx,a.cy);this.plot(h)}else{var h=this.uscene.lineDistancePoint(c,d,r.cx,r.cy,t,e);this.plot(h)}var l=this.bbox();this.title.move(l.cx,l.cy)},t}(),brokenLine=function(t){function e(t,e){this.uscene=t,this.sNode=e.sNode,this.eNode=e.eNode,this.option=e,this.init()}return __extends(e,t),e.prototype.creatText=function(){var t=this.line._array.value,e=[],n=t.length;e=n%2==0?[t[n/2][0]/2+t[n/2-1][0]/2,t[n/2][1]/2+t[n/2-1][1]/2]:t[parseInt(n/2)],this.title=this.uscene.draw.text(this.option.title.text).move(e[0],e[1]),this.title.attr(this.option.title.style).font(this.option.title.style).attr({id:this.line.id+"_title"}),this.line.title=this.title},e.prototype.lineChange=function(t,e,n){var i=SVG.get(this.sNode).container,o=SVG.get(this.eNode).container,r=i.tbox(),a=o.tbox();if(n==this.sNode){var s=$.extend(!0,[],this._array.value),c=s.length,d=!1;if(s[c-2][1]>a.cy&&s[c-1][1]<a.cy?(a.cy=a.cy+a.h/2,d=!0):s[c-2][1]<a.cy&&s[c-1][1]>a.cy?(a.cy=a.cy-a.h/2,d=!0):s[c-2][0]>a.cx&&s[c-1][0]<a.cx?(a.cx=a.cx+a.w/2,d=!0):s[c-2][0]<a.cx&&s[c-1][0]>a.cx&&(a.cx=a.cx-a.w/2,d=!0),d){if((s[c-1][0]-s[0][0])*(a.cx-s[0][0])*(s[c-1][1]-s[0][1])*(a.cy-s[0][1])==0)return!1;for(var h=(a.cx-s[0][0])/(s[c-1][0]-s[0][0]),l=(a.cy-s[0][1])/(s[c-1][1]-s[0][1]),u=1;u<s.length-1;u++)s[u][0]=(s[u][0]-s[0][0])*h+s[0][0],s[u][1]=(s[u][1]-s[0][1])*l+s[0][1];s[c-1][0]=a.cx,s[c-1][1]=a.cy,this.plot(s)}if(parseInt(s[0][1])==parseInt(s[1][1])?s[1][0]>s[0][0]-r.w/2?t+=r.w/2:s[1][0]<s[0][0]+r.w/2&&(t-=r.w/2):s[1][1]>s[0][1]?e+=r.h/2:s[1][1]<s[0][1]+r.h/2&&(e-=r.h/2),(s[c-1][0]-s[0][0])*(s[c-1][0]-t)*(s[c-1][1]-s[0][1])*(s[c-1][1]-e)==0)return!1;for(var h=(s[c-1][0]-t)/(s[c-1][0]-s[0][0]),l=(s[c-1][1]-e)/(s[c-1][1]-s[0][1]),u=1;u<s.length-1;u++)s[u][0]=s[c-1][0]-(s[c-1][0]-s[u][0])*h,s[u][1]=s[c-1][1]-(s[c-1][1]-s[u][1])*l;s[0][0]=t,s[0][1]=e,this.plot(s)}else{var s=$.extend(!0,[],this._array.value),c=s.length,p=!1;if(s[1][1]>r.cy&&s[0][1]<r.cy?(r.cy=r.cy+r.h/2,p=!0):s[1][1]<r.cy&&s[0][1]>r.cy?(r.cy=r.cy-r.h/2,p=!0):s[1][0]>r.cx&&s[0][0]<r.cx?(r.cx=r.cx+r.w/2,p=!0):s[1][0]<r.cx&&s[0][0]>r.cx&&(r.cx=r.cx-r.w/2,p=!0),p){if((s[c-1][0]-s[0][0])*(s[c-1][0]-r.cx)*(s[c-1][1]-s[0][1])*(s[c-1][1]-r.cy)==0)return!1;for(var h=(s[c-1][0]-r.cx)/(s[c-1][0]-s[0][0]),l=(s[c-1][1]-r.cy)/(s[c-1][1]-s[0][1]),u=1;u<s.length-1;u++)s[u][0]=s[c-1][0]-(s[c-1][0]-s[u][0])*h,s[u][1]=s[c-1][1]-(s[c-1][1]-s[u][1])*l;s[0][0]=r.cx,s[0][1]=r.cy,this.plot(s)}if(parseInt(s[c-2][1])==parseInt(s[c-1][1])?s[c-2][0]>s[c-1][0]-a.w/2?t+=a.w/2:s[c-2][0]<s[c-1][0]+a.w/2&&(t-=a.w/2):s[c-2][1]>s[c-1][1]-a.h/2?e+=a.h/2:s[c-2][1]<s[c-1][1]+a.h/2&&(e-=a.h/2),(s[c-1][0]-s[0][0])*(t-s[0][0])*(s[c-1][1]-s[0][1])*(e-s[0][1])==0)return!1;for(var h=(t-s[0][0])/(s[c-1][0]-s[0][0]),l=(e-s[0][1])/(s[c-1][1]-s[0][1]),u=1;u<s.length-1;u++)s[u][0]=(s[u][0]-s[0][0])*h+s[0][0],s[u][1]=(s[u][1]-s[0][1])*l+s[0][1];s[c-1][0]=t,s[c-1][1]=e,this.plot(s)}var g=[];g=c%2==0?[s[c/2][0]/2+s[c/2-1][0]/2,s[c/2][1]/2+s[c/2-1][1]/2]:s[parseInt(c/2)],this.title.move(g[0],g[1])},e}(line);